library(tidyverse)
library(stringr)
library(reshape2)
setwd('~/Desktop/008v/kraken/')
true_file <- read_tsv(file='008.comp', col_names=TRUE)
bacterial_genus <- read_tsv(file='008v_bacterial_genus', col_names=FALSE)
viral_genus <- read_tsv(file='008v_viral_classifications', col_names=FALSE)
#split up coverage information
bacterial_cov <- bacterial_genus %>% separate(X1, c('length', 'coverage'), sep='_cov_', remove=FALSE)
viral_cov <- viral_genus %>% separate(X1, c('length', 'coverage'), sep='_cov_', remove=FALSE)
#convert coverage to numeric
bacterial_cov$coverage <- as.numeric(bacterial_cov$coverage)
viral_cov$coverage <- as.numeric(viral_cov$coverage)
# set detection status ( all viral classifications are true positive)
viral_cov$detection_status = 'Viral_True_Positive'
#split up bacteiral into genus only
bacterial_cov <- bacterial_cov %>% separate(X2, c('higher_taxa', 'pre_genus'), sep='g__', remove=FALSE)
bacterial_cov <- bacterial_cov %>% separate(pre_genus, c('genus', 'species'), sep="[|]", remove=FALSE)
#set list of unique genera in true file
true_genera <- unique(true_file$Genus)
#mutate bacterial genus to add detection status
bacterial_cov <- bacterial_cov %>% mutate(detection_status = case_when(
genus %in% true_genera ~ 'Bacterial_True_Positive',
TRUE ~ 'Bacterial_False_Positive'
))
#isolate contig length information
bacterial_cov <- bacterial_cov %>% separate(length, c('info', 'length'), sep='_length_', remove=FALSE)
viral_cov <- viral_cov %>% separate(length, c('info', 'length'), sep='_length_', remove=FALSE)
bacterial_cov$length <- as.numeric(bacterial_cov$length)
viral_cov$length  <- as.numeric(viral_cov$length)
#bind viral and bacterial back togehter
bacterial_plot <- bacterial_cov %>% select(coverage, detection_status, length)
viral_plot <- viral_cov %>% select(coverage, detection_status, length)
merged_cov <- rbind(bacterial_plot, viral_plot)
View(merged_cov)
View(bacterial_cov)
false_positives <- bacterial_cov %>% filter(detection_status == 'Bacterial_False_Positive')
false_positives$info
View(false_positives)
false_positives$genus
unique(true_file$Genus)
